<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The Vault</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg:#0f0e17; --surface:#1a1826; --card:#211f32; --border:#2e2b47;
  --text:#f0eeff; --muted:#7a758f; --pink:#ff6bcb; --cyan:#5ee7ff; --green:#7cff6b; --red:#ff4466; --yellow:#ffe566;
}
body{background:var(--bg);color:var(--text);font-family:'Nunito',sans-serif;margin:0;overflow-x:hidden;}
header{padding:1.1rem 2rem;display:flex;align-items:center;justify-content:space-between;border-bottom:2px solid var(--border);background:var(--surface);position:sticky;top:0;z-index:100;}
.logo{font-family:'Fredoka One',cursive;font-size:1.8rem;color:var(--cyan);}
.logo span{color:var(--pink);}

.auth-btns{display:flex;gap:10px;align-items:center;}
.btn-user{background:var(--card);border:1px solid var(--border);color:white;padding:8px 15px;border-radius:8px;cursor:pointer;font-weight:800;}
.admin-badge{background:var(--red);color:white;font-size:0.6rem;font-weight:900;padding:2px 6px;border-radius:4px;text-transform:uppercase;}

.tab-bar{display:flex;background:var(--surface);border-bottom:2px solid var(--border);overflow-x:auto;}
.tab-btn{padding:1rem 1.5rem;background:none;border:none;color:var(--muted);font-weight:800;cursor:pointer;white-space:nowrap;transition: 0.2s;}
.tab-btn.active{color:var(--cyan);border-bottom:3px solid var(--cyan);}

.tab-panel{display:none;padding:2rem;max-width:1400px;margin:auto;}
.tab-panel.active{display:block;animation:fadeIn 0.3s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

.cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem;}

/* CARD STYLES */
.card{background:var(--card);border:2px solid var(--border);border-radius:20px;overflow:hidden;transition:0.2s;display:flex;flex-direction:column;}
.card:hover{border-color:var(--cyan);}
.thumb img{width:100%;aspect-ratio:1.2;object-fit:cover;}
.card-body{padding:1.2rem;display:flex;flex-direction:column;gap:10px;flex-grow:1;}

.copy-btn{background:var(--surface);border:2px solid var(--border);padding:10px;border-radius:12px;cursor:pointer;color:white;text-align:left;width:100%;}
.btn-label{display:block;font-size:0.6rem;color:var(--cyan);font-weight:900;text-transform:uppercase;}

/* FORM */
.upload-box{margin-top:40px; background:var(--surface); padding:2rem; border-radius:20px; border:2px solid var(--border);}
input, textarea, select{width:100%;padding:12px;background:var(--bg);border:2px solid var(--border);color:white;border-radius:10px;margin-bottom:12px;box-sizing:border-box;font-family:inherit;}
.btn-main{width:100%;padding:14px;border-radius:12px;border:none;font-weight:900;cursor:pointer;background:var(--cyan);color:black;}

/* MODAL */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:1000;}
.modal.show{display:flex;}
.modal-content{background:var(--card);padding:2rem;border-radius:24px;width:350px;border:2px solid var(--border);text-align:center;}
</style>
</head>
<body>

<header>
  <div class="logo">The <span>Vault</span></div>
  <div class="auth-btns" id="auth-ui">
    <button class="btn-user" onclick="openModal()">Login / Sign Up</button>
  </div>
</header>

<div class="tab-bar">
  <button class="tab-btn active" data-tab="meshes">üß± Meshes</button>
  <button class="tab-btn" data-tab="movesets">‚öîÔ∏è Movesets</button>
  <button class="tab-btn" data-tab="tutorials">üì∫ Tutorials</button>
  <button class="tab-btn" data-tab="sounds">üîä Sounds</button>
</div>

<div class="tab-panel active" id="tab-meshes">
  <div class="cards-grid" id="mesh-grid"></div>
  <div class="upload-box auth-only" style="display:none">
    <h3>Upload Mesh</h3>
    <input id="m-name" placeholder="Name">
    <input id="m-assetid" placeholder="Roblox Asset ID">
    <button class="btn-main" onclick="submitMesh()">Post Mesh</button>
  </div>
</div>

<div class="tab-panel" id="tab-movesets">
  <div class="cards-grid" id="moveset-grid"></div>
  <div class="upload-box auth-only" style="display:none">
    <h3>Upload Moveset</h3>
    <input id="mv-name" placeholder="Moveset Name">
    <textarea id="mv-code" placeholder="Paste Code"></textarea>
    <button class="btn-main" style="background:var(--pink)" onclick="submitMoveset()">Post Moveset</button>
  </div>
</div>

<div class="tab-panel" id="tab-tutorials">
  <div class="cards-grid" id="tutorial-grid"></div>
  <div class="upload-box auth-only" style="display:none">
    <h3>Upload Video Tutorial</h3>
    <input id="t-name" placeholder="Tutorial Title">
    <input id="t-url" placeholder="YouTube URL (e.g. https://youtu.be/...)">
    <button class="btn-main" style="background:var(--yellow)" onclick="submitTutorial()">Post Tutorial</button>
  </div>
</div>

<div class="tab-panel" id="tab-sounds">
  <div class="cards-grid" id="sound-grid"></div>
  <div class="upload-box auth-only" style="display:none">
    <h3>Upload Sound FX</h3>
    <input id="s-name" placeholder="Sound Name">
    <input id="s-assetid" placeholder="Roblox Audio ID">
    <button class="btn-main" style="background:var(--green)" onclick="submitSound()">Post Sound</button>
  </div>
</div>

<div class="modal" id="auth-modal">
  <div class="modal-content">
    <h2>Account Access</h2>
    <input type="email" id="auth-email" placeholder="Email">
    <input type="password" id="auth-pass" placeholder="Password">
    <button class="btn-main" onclick="handleAuth('login')">Login</button>
    <button class="btn-main" style="background:var(--surface); color:white; margin-top:10px;" onclick="handleAuth('signup')">Sign Up</button>
    <button onclick="closeModal()" style="margin-top:10px; background:none; border:none; color:var(--muted); cursor:pointer;">Cancel</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, setDoc, doc, getDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAppd2GsEJyzdN8TxOLCmFOiSXikkXQAuM",
    authDomain: "the-vault-1ea3a.firebaseapp.com",
    projectId: "the-vault-1ea3a",
    storageBucket: "the-vault-1ea3a.firebasestorage.app",
    messagingSenderId: "780186978448",
    appId: "1:780186978448:web:cf80b8c1bb6f70d3b3b015"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const ADMIN_UID = "6eMRv5PgObXsKys66yNzOYRLWGp2";
  let currentUser = null;

  // --- TAB SYSTEM ---
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.tab-btn, .tab-panel').forEach(el => el.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
    };
  });

  // --- AUTH ---
  window.openModal = () => document.getElementById('auth-modal').classList.add('show');
  window.closeModal = () => document.getElementById('auth-modal').classList.remove('show');

  window.handleAuth = async (type) => {
    const email = document.getElementById('auth-email').value;
    const pass = document.getElementById('auth-pass').value;
    try {
      if(type === 'signup') {
        const res = await createUserWithEmailAndPassword(auth, email, pass);
        await setDoc(doc(db, "users", res.user.uid), { email, isBanned: false });
      } else { await signInWithEmailAndPassword(auth, email, pass); }
      closeModal();
    } catch(e) { alert(e.message); }
  };

  onAuthStateChanged(auth, async (user) => {
    currentUser = user;
    const ui = document.getElementById('auth-ui');
    const authForms = document.querySelectorAll('.auth-only');

    if(user) {
      const snap = await getDoc(doc(db, "users", user.uid));
      if(snap.exists() && snap.data().isBanned) { alert("Banned."); signOut(auth); return; }
      authForms.forEach(f => f.style.display = 'block');
      ui.innerHTML = `<span>${user.email.split('@')[0]}</span> ${user.uid === ADMIN_UID ? '<span class="admin-badge">Admin</span>' : ''} <button class="btn-user" onclick="auth.signOut()">Logout</button>`;
    } else {
      authForms.forEach(f => f.style.display = 'none');
      ui.innerHTML = `<button class="btn-user" onclick="openModal()">Login / Sign Up</button>`;
    }
  });

  // --- ADMIN ACTIONS ---
  window.deleteItem = (col, id) => { if(confirm("Delete this?")) deleteDoc(doc(db, col, id)); };
  window.banUser = (uid) => { if(confirm("Ban this user?")) updateDoc(doc(db, "users", uid), {isBanned: true}); };

  // --- UPLOAD FUNCTIONS ---
  window.submitMesh = async () => {
    await addDoc(collection(db, "meshes"), { name: document.getElementById('m-name').value, assetId: document.getElementById('m-assetid').value, userId: currentUser.uid, createdAt: Date.now() });
    alert("Uploaded!");
  };
  window.submitMoveset = async () => {
    await addDoc(collection(db, "movesets"), { name: document.getElementById('mv-name').value, code: document.getElementById('mv-code').value, userId: currentUser.uid, createdAt: Date.now() });
    alert("Uploaded!");
  };
  window.submitTutorial = async () => {
    const url = document.getElementById('t-url').value;
    const vidId = url.split('v=')[1] || url.split('/').pop();
    await addDoc(collection(db, "tutorials"), { name: document.getElementById('t-name').value, url, vidId, userId: currentUser.uid, createdAt: Date.now() });
    alert("Uploaded!");
  };
  window.submitSound = async () => {
    await addDoc(collection(db, "sounds"), { name: document.getElementById('s-name').value, assetId: document.getElementById('s-assetid').value, userId: currentUser.uid, createdAt: Date.now() });
    alert("Uploaded!");
  };

  // --- DATA SYNC ---
  const sync = (col, gridId, renderFn) => {
    onSnapshot(query(collection(db, col), orderBy("createdAt", "desc")), (s) => {
      document.getElementById(gridId).innerHTML = s.docs.map(d => renderFn({id: d.id, ...d.data()})).join('');
    });
  };

  sync("meshes", "mesh-grid", (m) => `
    <div class="card">
      <div class="thumb"><img src="https://thumbnails.roblox.com/v1/assets?assetIds=${m.assetId}&size=420x420&format=Png"></div>
      <div class="card-body">
        <strong>${m.name}</strong>
        <button class="copy-btn" onclick="navigator.clipboard.writeText('rbxassetid://${m.assetId}')"><span class="btn-label">Mesh ID</span>rbxassetid://${m.assetId}</button>
        ${currentUser?.uid === ADMIN_UID ? `<button onclick="deleteItem('meshes','${m.id}')" style="color:red; background:none; border:none;">Delete</button> <button onclick="banUser('${m.userId}')" style="color:orange; background:none; border:none;">Ban User</button>` : ''}
      </div>
    </div>
  `);

  sync("movesets", "moveset-grid", (m) => `
    <div class="card" style="padding:1rem;">
      <strong>‚öîÔ∏è ${m.name}</strong>
      <textarea readonly style="height:60px; font-size:10px; margin-top:10px;">${m.code}</textarea>
      <button class="btn-main" style="background:var(--pink); margin-top:10px;" onclick="navigator.clipboard.writeText('${m.code}')">Copy Code</button>
      ${currentUser?.uid === ADMIN_UID ? `<button onclick="deleteItem('movesets','${m.id}')" style="color:red; background:none; border:none; margin-top:5px;">Delete</button>` : ''}
    </div>
  `);

  sync("tutorials", "tutorial-grid", (t) => `
    <div class="card">
      <div class="thumb"><img src="https://img.youtube.com/vi/${t.vidId}/hqdefault.jpg"></div>
      <div class="card-body">
        <strong>${t.name}</strong>
        <a href="${t.url}" target="_blank" class="btn-main" style="background:var(--yellow); text-align:center; text-decoration:none; display:block;">Watch Tutorial</a>
        ${currentUser?.uid === ADMIN_UID ? `<button onclick="deleteItem('tutorials','${m.id}')" style="color:red; background:none; border:none;">Delete</button>` : ''}
      </div>
    </div>
  `);

  sync("sounds", "sound-grid", (s) => `
    <div class="card" style="padding:1rem;">
      <strong>üîä ${s.name}</strong>
      <button class="copy-btn" style="margin-top:10px; border-color:var(--green)" onclick="navigator.clipboard.writeText('${s.assetId}')"><span class="btn-label" style="color:var(--green)">Sound ID</span>${s.assetId}</button>
      ${currentUser?.uid === ADMIN_UID ? `<button onclick="deleteItem('sounds','${s.id}')" style="color:red; background:none; border:none; margin-top:5px;">Delete</button>` : ''}
    </div>
  `);
</script>
</body>
</html>
