<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The Vault</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg:#0f0e17; --surface:#1a1826; --card:#211f32; --border:#2e2b47;
  --text:#f0eeff; --muted:#7a758f; --pink:#ff6bcb; --cyan:#5ee7ff; --green:#7cff6b; --red:#ff4466;
}
body{background:var(--bg);color:var(--text);font-family:'Nunito',sans-serif;margin:0;overflow-x:hidden;}
header{padding:1.1rem 2rem;display:flex;align-items:center;justify-content:space-between;border-bottom:2px solid var(--border);background:var(--surface);position:sticky;top:0;z-index:100;}
.logo{font-family:'Fredoka One',cursive;font-size:1.8rem;color:var(--cyan);}
.logo span{color:var(--pink);}

.auth-btns{display:flex;gap:10px;align-items:center;}
.btn-user{background:var(--card);border:1px solid var(--border);color:white;padding:8px 15px;border-radius:8px;cursor:pointer;font-weight:800;}
.admin-badge{background:var(--red);color:white;font-size:0.6rem;font-weight:900;padding:2px 6px;border-radius:4px;text-transform:uppercase;}

.tab-bar{display:flex;background:var(--surface);border-bottom:2px solid var(--border);overflow-x:auto;}
.tab-btn{padding:1rem 1.5rem;background:none;border:none;color:var(--muted);font-weight:800;cursor:pointer;white-space:nowrap;}
.tab-btn.active{color:var(--cyan);border-bottom:3px solid var(--cyan);}

.tab-panel{display:none;padding:2rem;max-width:1400px;margin:auto;}
.tab-panel.active{display:block;animation:fadeIn 0.3s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

.cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem;}

/* MESH CARDS */
.mesh-card{background:var(--card);border:2px solid var(--border);border-radius:20px;overflow:hidden;transition:0.2s;}
.mesh-card:hover{border-color:var(--cyan);}
.mesh-thumb img{width:100%;aspect-ratio:1.2;object-fit:cover;}
.mesh-body{padding:1.2rem;display:flex;flex-direction:column;gap:10px;}
.mesh-title-row{display:flex;justify-content:space-between;align-items:center;}

.main-copy-btns{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.copy-btn{background:var(--surface);border:2px solid var(--border);padding:10px;border-radius:12px;cursor:pointer;color:white;text-align:left;transition:0.2s;}
.copy-btn:hover{border-color:var(--cyan);background:rgba(94,231,255,0.05);}
.btn-label{display:block;font-size:0.6rem;color:var(--cyan);font-weight:900;text-transform:uppercase;}

/* MODAL */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:1000;}
.modal-content{background:var(--card);padding:2.5rem;border-radius:24px;width:380px;border:2px solid var(--border);text-align:center;}
.modal.show{display:flex;}
input, textarea{width:100%;padding:12px;background:var(--bg);border:2px solid var(--border);color:white;border-radius:10px;margin-bottom:12px;box-sizing:border-box;font-family:inherit;}

.btn-main{width:100%;padding:14px;border-radius:12px;border:none;font-weight:900;cursor:pointer;background:var(--cyan);color:black;font-size:1rem;}
.btn-del{background:none;border:none;color:var(--red);font-size:0.75rem;font-weight:800;cursor:pointer;margin-top:5px;text-decoration:underline;}

.system-tag{font-size:0.5rem;background:rgba(124,255,107,0.1);color:var(--green);padding:2px 4px;border-radius:3px;margin-left:4px;}
</style>
</head>
<body>

<header>
  <div class="logo">The <span>Vault</span></div>
  <div class="auth-btns" id="auth-ui">
    <button class="btn-user" onclick="openModal()">Login / Sign Up</button>
  </div>
</header>

<div class="tab-bar">
  <button class="tab-btn active" data-tab="meshes">üß± Meshes</button>
  <button class="tab-btn" data-tab="movesets">‚öîÔ∏è JJS Movesets</button>
</div>

<div class="tab-panel active" id="tab-meshes">
  <div class="cards-grid" id="mesh-grid"></div>
  <div id="upload-area" style="display:none; margin-top:40px; background:var(--surface); padding:2rem; border-radius:20px; border:2px solid var(--border);">
    <h2 style="margin-bottom:1.5rem">‚ûï Submit to the Vault</h2>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
      <input id="m-name" placeholder="Name (e.g. Cursed Katana)">
      <input id="m-assetid" placeholder="Roblox Asset ID">
      <input id="m-meshid" placeholder="Internal Mesh ID (Optional)">
      <input id="m-textid" placeholder="Texture ID (Optional)">
    </div>
    <button class="btn-main" id="m-submit">Upload Mesh</button>
  </div>
</div>

<div class="tab-panel" id="tab-movesets">
  <div class="cards-grid" id="moveset-grid"></div>
  <div id="mv-upload-area" style="display:none; margin-top:40px; background:var(--surface); padding:2rem; border-radius:20px; border:2px solid var(--border);">
    <h2>‚öîÔ∏è Submit JJS Moveset</h2>
    <input id="mv-name" placeholder="Moveset Name">
    <textarea id="mv-code" placeholder="Paste Code Here" style="height:150px"></textarea>
    <button class="btn-main" style="background:var(--pink)" id="mv-submit">Upload Moveset</button>
  </div>
</div>

<div class="modal" id="auth-modal">
  <div class="modal-content">
    <h2 id="modal-title" style="margin-bottom:1.5rem">Account Access</h2>
    <input type="email" id="auth-email" placeholder="Email Address">
    <input type="password" id="auth-pass" placeholder="Password">
    <button class="btn-main" onclick="handleAuth('login')">Login</button>
    <button class="btn-main" style="background:var(--surface); color:white; margin-top:12px;" onclick="handleAuth('signup')">Sign Up</button>
    <button onclick="closeModal()" style="background:none; border:none; color:var(--muted); cursor:pointer; width:100%; margin-top:15px; font-weight:800;">Close</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, setDoc, doc, getDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAppd2GsEJyzdN8TxOLCmFOiSXikkXQAuM",
    authDomain: "the-vault-1ea3a.firebaseapp.com",
    projectId: "the-vault-1ea3a",
    storageBucket: "the-vault-1ea3a.firebasestorage.app",
    messagingSenderId: "780186978448",
    appId: "1:780186978448:web:cf80b8c1bb6f70d3b3b015"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // --- ADMIN CONFIG ---
  const ADMIN_UID = "6eMRv5PgObXsKys66yNzOYRLWGp2"; 
  let currentUser = null;

  // --- AUTH HANDLERS ---
  window.openModal = () => document.getElementById('auth-modal').classList.add('show');
  window.closeModal = () => document.getElementById('auth-modal').classList.remove('show');

  window.handleAuth = async (type) => {
    const email = document.getElementById('auth-email').value;
    const pass = document.getElementById('auth-pass').value;
    try {
      if(type === 'signup') {
        const res = await createUserWithEmailAndPassword(auth, email, pass);
        await setDoc(doc(db, "users", res.user.uid), { email, isBanned: false, createdAt: Date.now() });
      } else {
        await signInWithEmailAndPassword(auth, email, pass);
      }
      closeModal();
    } catch(e) { alert(e.message); }
  };

  onAuthStateChanged(auth, async (user) => {
    currentUser = user;
    const ui = document.getElementById('auth-ui');
    const mArea = document.getElementById('upload-area');
    const mvArea = document.getElementById('mv-upload-area');

    if(user) {
      const userSnap = await getDoc(doc(db, "users", user.uid));
      if(userSnap.exists() && userSnap.data().isBanned) {
        alert("You have been banned from The Vault.");
        signOut(auth); return;
      }
      mArea.style.display = 'block';
      mvArea.style.display = 'block';
      ui.innerHTML = `<span>${user.email.split('@')[0]}</span> ${user.uid === ADMIN_UID ? '<span class="admin-badge">Admin</span>' : ''} <button class="btn-user" onclick="auth.signOut()">Logout</button>`;
    } else {
      mArea.style.display = 'none';
      mvArea.style.display = 'none';
      ui.innerHTML = `<button class="btn-user" onclick="openModal()">Login / Sign Up</button>`;
    }
  });

  // --- RENDERING ---
  const renderMeshes = (data) => {
    document.getElementById('mesh-grid').innerHTML = data.map(m => `
      <div class="mesh-card">
        <div class="mesh-thumb"><img src="https://thumbnails.roblox.com/v1/assets?assetIds=${m.assetId}&size=420x420&format=Png" onerror="this.src='https://via.placeholder.com/400?text=No+Image'"></div>
        <div class="mesh-body">
          <div class="mesh-title-row">
            <strong>${m.name}</strong>
            ${currentUser?.uid === ADMIN_UID ? `<button class="btn-del" onclick="if(confirm('Delete?')) deleteDoc(doc(db,'meshes','${m.id}'))">Delete</button>` : ''}
          </div>
          <div class="main-copy-btns">
            <button class="copy-btn" onclick="navigator.clipboard.writeText('${m.meshId}'); alert('Copied Mesh ID')">
              <span class="btn-label">Mesh ID ${m.autoMesh ? '<span class="system-tag">SYS</span>' : ''}</span>
              <span style="font-size:0.75rem">${m.meshId}</span>
            </button>
            <button class="copy-btn" onclick="navigator.clipboard.writeText('${m.textureId}'); alert('Copied Texture ID')">
              <span class="btn-label" style="color:var(--pink)">Texture ID</span>
              <span style="font-size:0.75rem">${m.textureId}</span>
            </button>
          </div>
          ${currentUser?.uid === ADMIN_UID ? `<button class="btn-del" style="color:var(--yellow)" onclick="if(confirm('Ban User?')) updateDoc(doc(db,'users','${m.userId}'), {isBanned: true})">Ban Uploader</button>` : ''}
        </div>
      </div>
    `).join('');
  };

  // --- DATABASE OPS ---
  document.getElementById('m-submit').onclick = async () => {
    const mesh = document.getElementById('m-meshid').value.trim();
    const tex = document.getElementById('m-textid').value.trim();
    const asset = document.getElementById('m-assetid').value.trim();
    
    await addDoc(collection(db, "meshes"), {
      name: document.getElementById('m-name').value,
      assetId: asset,
      meshId: mesh || ("rbxassetid://" + asset),
      textureId: tex || "None",
      autoMesh: !mesh,
      userId: currentUser.uid,
      createdAt: Date.now()
    });
    alert("Uploaded!");
  };

  // Sync
  onSnapshot(query(collection(db, "meshes"), orderBy("createdAt", "desc")), (s) => {
    renderMeshes(s.docs.map(d => ({id: d.id, ...d.data()})));
  });

  // Tab Switcher
  document.querySelectorAll('.tab-btn').forEach(b => {
    b.onclick = () => {
      document.querySelectorAll('.tab-btn, .tab-panel').forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      document.getElementById('tab-' + b.dataset.tab).classList.add('active');
    }
  });
</script>
</body>
</html>
